<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Escolar - Grupo 3¬∞1</title>

<style>
  /* ESTILOS GENERALES */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: 0;
    padding: 0;
    min-height: 100vh;
  }

  h1 {
    background: rgba(255, 255, 255, 0.95);
    padding: 20px;
    margin: 0;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    color: #333;
  }

  /* CONTENEDORES PRINCIPALES */
  .caja {
    background: white;
    margin: 30px auto;
    padding: 0;
    width: 95%;
    max-width: 1200px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    overflow: hidden;
  }

  /* PANTALLAS DE LOGIN */
  #bienvenida, #login, #loginAlumno, #loginMaestro {
    text-align: center;
    padding: 40px 20px;
  }

  #bienvenida .logo, #login .logo {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 50px;
    color: white;
  }

  button, input, textarea, select {
    width: 80%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    transition: all 0.3s ease;
  }

  button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    cursor: pointer;
    font-weight: 600;
  }

  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  input, textarea, select {
    border: 2px solid #e1e5e9;
    background: #f8f9fa;
  }

  input:focus, textarea:focus, select:focus {
    border-color: #667eea;
    outline: none;
    background: white;
  }

  .oculto {
    display: none;
  }

  .mensaje-error {
    color: #e74c3c;
    font-size: 14px;
    margin: 10px 0;
  }

  /* DISE√ëO CON BARRA LATERAL PARA PANELES */
  .panel-contenedor {
    display: flex;
    min-height: 600px;
  }

  /* BARRA LATERAL */
  .sidebar {
    width: 250px;
    background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 0;
  }

  .sidebar-header {
    padding: 30px 20px;
    background: rgba(0,0,0,0.2);
    text-align: center;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .sidebar-header h3 {
    margin: 10px 0 5px;
    font-size: 18px;
  }

  .sidebar-header p {
    margin: 0;
    opacity: 0.8;
    font-size: 14px;
  }

  .user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 35px;
    border: 3px solid rgba(255,255,255,0.2);
  }

  .menu-lateral {
    list-style: none;
    padding: 0;
    margin: 20px 0;
  }

  .menu-item {
    padding: 15px 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 4px solid transparent;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .menu-item:hover {
    background: rgba(255,255,255,0.1);
    border-left-color: #3498db;
  }

  .menu-item.activo {
    background: rgba(255,255,255,0.15);
    border-left-color: #3498db;
  }

  .menu-item i {
    font-size: 18px;
    width: 20px;
    text-align: center;
  }

  /* CONTENIDO PRINCIPAL */
  .contenido-principal {
    flex: 1;
    padding: 30px;
    background: #f8f9fa;
    overflow-y: auto;
  }

  .contenido-seccion {
    display: none;
  }

  .contenido-seccion.activa {
    display: block;
    animation: fadeIn 0.5s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* TARJETAS DE INFORMACI√ìN */
  .tarjeta {
    background: white;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    border-left: 4px solid #3498db;
  }

  .tarjeta h4 {
    color: #2c3e50;
    margin-top: 0;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
  }

  /* LISTA DE MATERIAS */
  .lista-materias {
    display: grid;
    gap: 10px;
  }

  .materia-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: #f8f9fa;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .materia-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
  }

  .calificacion {
    font-weight: bold;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 14px;
  }

  .calificacion.alta {
    background: #d4edda;
    color: #155724;
  }

  .calificacion.media {
    background: #fff3cd;
    color: #856404;
  }

  .calificacion.baja {
    background: #f8d7da;
    color: #721c24;
  }

  /* TABLA DE ALUMNOS */
  .tabla-contenedor {
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  }

  th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #e1e5e9;
  }

  th {
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
  }

  tr:hover {
    background: #f8f9fa;
  }

  /* BOTONES DE ACCI√ìN */
  .btn-accion {
    padding: 8px 15px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
    width: auto;
    margin: 2px;
  }

  .btn-editar {
    background: #3498db;
    color: white;
  }

  .btn-eliminar {
    background: #e74c3c;
    color: white;
  }

  .btn-seleccionar {
    background: #27ae60;
    color: white;
  }

  .btn-info {
    background: #17a2b8;
    color: white;
  }

  .btn-accion:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
  }

  /* FORMULARIOS */
  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #2c3e50;
  }

  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
  }

  .formulario-calificaciones {
    margin-top: 20px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e1e5e9;
  }

  .materia-calificacion {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #e1e5e9;
  }

  .materia-calificacion:last-child {
    border-bottom: none;
  }

  .materia-calificacion label {
    flex: 1;
    margin-bottom: 0;
  }

  .materia-calificacion input {
    width: 80px;
    margin-left: 15px;
  }

  /* NUEVOS ESTILOS PARA FUNCIONALIDADES */
  .estado-asistencia {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
  }

  .asistio {
    background: #d4edda;
    color: #155724;
  }

  .falta {
    background: #f8d7da;
    color: #721c24;
  }

  .retardo {
    background: #fff3cd;
    color: #856404;
  }

  .comunicado {
    background: #fff;
    border-left: 4px solid #3498db;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  .comunicado.importante {
    border-left-color: #e74c3c;
    background: #fff5f5;
  }

  .comunicado .fecha {
    font-size: 12px;
    color: #6c757d;
    margin-bottom: 5px;
  }

  .grafico-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
  }

  .estadistica {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 5px;
  }

  .recordatorio {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    padding: 10px 15px;
    margin-bottom: 10px;
    border-radius: 5px;
  }

  /* ESTILOS PARA EL HORARIO MEJORADO */
  .horario-mejorado {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  }
  
  .dias-semana {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #e1e5e9;
  }
  
  .dia-tab {
    flex: 1;
    padding: 15px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-weight: 600;
    color: #6c757d;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
  }
  
  .dia-tab:hover {
    background: #e9ecef;
    color: #495057;
  }
  
  .dia-tab.activo {
    color: #3498db;
    border-bottom-color: #3498db;
    background: white;
  }
  
  .contenido-horario {
    position: relative;
    min-height: 400px;
  }
  
  .dia-contenido {
    display: none;
    padding: 20px;
    animation: fadeIn 0.5s ease;
  }
  
  .dia-contenido.activo {
    display: block;
  }
  
  .clases-lista {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .clase-item {
    display: flex;
    align-items: center;
    background: #f8f9fa;
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
  }
  
  .clase-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  
  .clase-item.receso {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
  }
  
  .hora-clase {
    padding: 15px 20px;
    background: #2c3e50;
    color: white;
    font-weight: 600;
    min-width: 120px;
    text-align: center;
  }
  
  .clase-item.receso .hora-clase {
    background: #ffc107;
    color: #856404;
  }
  
  .materia-clase {
    flex: 1;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: white;
  }
  
  .clase-item.receso .materia-clase {
    background: #fff3cd;
    color: #856404;
    font-weight: 600;
  }
  
  .materia-nombre {
    flex: 1;
    font-weight: 500;
  }
  
  .materia-color {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin-left: 15px;
  }

  /* NUEVOS ESTILOS PARA SEMESTRES Y PARCIALES */
  .semestres-tabs {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #e1e5e9;
    margin-bottom: 20px;
  }
  
  .semestre-tab {
    flex: 1;
    padding: 15px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-weight: 600;
    color: #6c757d;
    transition: all 0.3s ease;
    border-bottom: 3px solid transparent;
  }
  
  .semestre-tab:hover {
    background: #e9ecef;
    color: #495057;
  }
  
  .semestre-tab.activo {
    color: #3498db;
    border-bottom-color: #3498db;
    background: white;
  }
  
  .parciales-tabs {
    display: flex;
    background: #f1f3f4;
    border-radius: 8px;
    margin-bottom: 20px;
    overflow: hidden;
  }
  
  .parcial-tab {
    flex: 1;
    padding: 12px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-weight: 500;
    color: #6c757d;
    transition: all 0.3s ease;
    border-right: 1px solid #e1e5e9;
  }
  
  .parcial-tab:last-child {
    border-right: none;
  }
  
  .parcial-tab:hover {
    background: #e9ecef;
    color: #495057;
  }
  
  .parcial-tab.activo {
    color: #3498db;
    background: white;
    font-weight: 600;
  }
  
  .contenido-semestre {
    display: none;
  }
  
  .contenido-semestre.activo {
    display: block;
    animation: fadeIn 0.5s ease;
  }
  
  .tabla-calificaciones {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
  }
  
  .tabla-calificaciones th {
    background: #f8f9fa;
    font-weight: 600;
    color: #2c3e50;
    text-align: center;
  }
  
  .tabla-calificaciones td {
    text-align: center;
    vertical-align: middle;
  }
  
  .input-calificacion {
    width: 60px;
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 4px;
    text-align: center;
    font-size: 14px;
  }
  
  .promedio-materia {
    font-weight: bold;
    padding: 4px 8px;
    border-radius: 4px;
    background: #f8f9fa;
  }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    .panel-contenedor {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      height: auto;
    }
    
    .menu-lateral {
      display: flex;
      overflow-x: auto;
    }
    
    .menu-item {
      flex: 1;
      min-width: 120px;
      justify-content: center;
      border-left: none;
      border-bottom: 4px solid transparent;
    }
    
    .menu-item:hover, .menu-item.activo {
      border-left-color: transparent;
      border-bottom-color: #3498db;
    }
    
    .dias-semana {
      flex-direction: column;
    }
    
    .clase-item {
      flex-direction: column;
    }
    
    .hora-clase {
      min-width: 100%;
      padding: 10px;
    }
    
    .semestres-tabs, .parciales-tabs {
      flex-direction: column;
    }
    
    .semestre-tab, .parcial-tab {
      border-right: none;
      border-bottom: 1px solid #e1e5e9;
    }
    
    .parcial-tab:last-child {
      border-bottom: none;
    }
  }
</style>

<!-- Iconos de Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Chart.js para gr√°ficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<h1>Sistema Escolar - Grupo 3¬∞1</h1>

<!-- BIENVENIDA -->
<div class="caja" id="bienvenida">
  <div class="logo">üè´</div>
  <h2>Bienvenido al Sistema Escolar</h2>
  <p>Sistema de gesti√≥n acad√©mica del grupo 3¬∞1</p>
  <br>
  <button onclick="mostrar('login')">Iniciar Sesi√≥n</button>
</div>

<!-- LOGIN -->
<div class="caja oculto" id="login">
  <div class="logo"><i class="fas fa-user-shield"></i></div>
  <h2>Inicio de Sesi√≥n</h2>
  <button onclick="mostrar('loginAlumno')"><i class="fas fa-user-graduate"></i> Alumno</button>
  <button onclick="mostrar('loginMaestro')"><i class="fas fa-chalkboard-teacher"></i> Maestro</button>
  <button onclick="volver()"><i class="fas fa-arrow-left"></i> Volver</button>
</div>

<!-- LOGIN ALUMNO -->
<div class="caja oculto" id="loginAlumno">
  <h3>Acceso Alumno</h3>
  <input type="text" id="control" placeholder="N√∫mero de Control (Ej: 31001)">
  <div id="errorAlumno" class="mensaje-error oculto"></div>
  <button onclick="entrarAlumno()"><i class="fas fa-sign-in-alt"></i> Entrar</button>
  <button onclick="mostrar('login')"><i class="fas fa-arrow-left"></i> Volver</button>
</div>

<!-- LOGIN MAESTRO -->
<div class="caja oculto" id="loginMaestro">
  <h3>Acceso Maestro</h3>
  <input type="text" id="maestro" placeholder="Nombre de usuario">
  <input type="password" id="password" placeholder="Contrase√±a">
  <div id="errorMaestro" class="mensaje-error oculto"></div>
  <div id="intentosInfo" class="intentos oculto"></div>
  <button onclick="entrarMaestro()"><i class="fas fa-sign-in-alt"></i> Entrar</button>
  <button onclick="mostrar('login')"><i class="fas fa-arrow-left"></i> Volver</button>
</div>

<!-- PANEL ALUMNO -->
<div class="caja oculto" id="panelAlumno">
  <div class="panel-contenedor">
    <!-- BARRA LATERAL -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="user-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="sidebarNombreAlumno"></h3>
        <p>Alumno - Grupo 3¬∞1</p>
      </div>
      
      <ul class="menu-lateral">
        <li class="menu-item activo" onclick="cambiarSeccion('resumen')">
          <i class="fas fa-home"></i> Resumen
        </li>
        <li class="menu-item" onclick="cambiarSeccion('horario')">
          <i class="fas fa-calendar-alt"></i> Horario
        </li>
        <li class="menu-item" onclick="cambiarSeccion('calificaciones')">
          <i class="fas fa-chart-bar"></i> Calificaciones
        </li>
        <li class="menu-item" onclick="cambiarSeccion('asistenciaAlumno')">
          <i class="fas fa-clipboard-check"></i> Mi Asistencia
        </li>
        <li class="menu-item" onclick="cambiarSeccion('comunicadosAlumno')">
          <i class="fas fa-bullhorn"></i> Comunicados
        </li>
        <li class="menu-item" onclick="cambiarSeccion('tareasAlumno')">
          <i class="fas fa-tasks"></i> Mis Tareas
        </li>
        <li class="menu-item" onclick="cambiarSeccion('datos')">
          <i class="fas fa-id-card"></i> Datos Personales
        </li>
        <li class="menu-item" onclick="cerrar()">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
        </li>
      </ul>
    </div>
    
    <!-- CONTENIDO PRINCIPAL -->
    <div class="contenido-principal">
      <!-- SECCI√ìN RESUMEN -->
      <div id="resumen" class="contenido-seccion activa">
        <div class="tarjeta">
          <h4><i class="fas fa-tachometer-alt"></i> Resumen Acad√©mico</h4>
          <div id="resumenContenido"></div>
        </div>
        <div class="tarjeta">
          <h4><i class="fas fa-bell"></i> Recordatorios</h4>
          <div id="recordatoriosContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN HORARIO -->
      <div id="horario" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-calendar-alt"></i> Horario de Clases</h4>
          <div id="horarioContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN CALIFICACIONES -->
      <div id="calificaciones" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-chart-bar"></i> Calificaciones</h4>
          <div id="calificacionesContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN ASISTENCIA ALUMNO -->
      <div id="asistenciaAlumno" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-clipboard-check"></i> Mi Asistencia</h4>
          <div id="asistenciaAlumnoContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN COMUNICADOS ALUMNO -->
      <div id="comunicadosAlumno" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-bullhorn"></i> Comunicados</h4>
          <div id="comunicadosAlumnoContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN TAREAS ALUMNO -->
      <div id="tareasAlumno" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-tasks"></i> Mis Tareas</h4>
          <div id="tareasAlumnoContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN DATOS PERSONALES -->
      <div id="datos" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-id-card"></i> Datos Personales</h4>
          <div id="datosContenido"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PANEL MAESTRO -->
<div class="caja oculto" id="panelMaestro">
  <div class="panel-contenedor">
    <!-- BARRA LATERAL -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="user-avatar">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <h3 id="sidebarNombreMaestro"></h3>
        <p>Maestro - Grupo 3¬∞1</p>
      </div>
      
      <ul class="menu-lateral">
        <li class="menu-item activo" onclick="cambiarSeccionMaestro('listaAlumnos')">
          <i class="fas fa-users"></i> Lista de Alumnos
        </li>
        <li class="menu-item" onclick="cambiarSeccionMaestro('modificarCalificaciones')">
          <i class="fas fa-edit"></i> Modificar Calificaciones
        </li>
        <li class="menu-item" onclick="cambiarSeccionMaestro('asistenciaMaestro')">
          <i class="fas fa-clipboard-check"></i> Control Asistencia
        </li>
        <li class="menu-item" onclick="cambiarSeccionMaestro('comunicadosMaestro')">
          <i class="fas fa-bullhorn"></i> Comunicados
        </li>
        <li class="menu-item" onclick="cambiarSeccionMaestro('tareasMaestro')">
          <i class="fas fa-tasks"></i> Asignar Tareas
        </li>
        <li class="menu-item" onclick="cambiarSeccionMaestro('reportesMaestro')">
          <i class="fas fa-chart-pie"></i> Reportes
        </li>
        <li class="menu-item" onclick="cambiarSeccionMaestro('bajaAlumnos')">
          <i class="fas fa-user-times"></i> Dar de Baja
        </li>
        <li class="menu-item" onclick="cerrar()">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
        </li>
      </ul>
    </div>
    
    <!-- CONTENIDO PRINCIPAL -->
    <div class="contenido-principal">
      <!-- SECCI√ìN LISTA DE ALUMNOS -->
      <div id="listaAlumnos" class="contenido-seccion activa">
        <div class="tarjeta">
          <h4><i class="fas fa-users"></i> Lista de Alumnos - Grupo 3¬∞1</h4>
          <div id="listaAlumnosContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN MODIFICAR CALIFICACIONES -->
      <div id="modificarCalificaciones" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-edit"></i> Modificar Calificaciones</h4>
          <div id="modificarCalificacionesContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN CONTROL ASISTENCIA -->
      <div id="asistenciaMaestro" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-clipboard-check"></i> Control de Asistencia</h4>
          <div id="asistenciaMaestroContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN COMUNICADOS MAESTRO -->
      <div id="comunicadosMaestro" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-bullhorn"></i> Comunicados</h4>
          <div id="comunicadosMaestroContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN ASIGNAR TAREAS -->
      <div id="tareasMaestro" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-tasks"></i> Asignar Tareas</h4>
          <div id="tareasMaestroContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN REPORTES -->
      <div id="reportesMaestro" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-chart-pie"></i> Reportes del Grupo</h4>
          <div id="reportesMaestroContenido"></div>
        </div>
      </div>
      
      <!-- SECCI√ìN DAR DE BAJA -->
      <div id="bajaAlumnos" class="contenido-seccion">
        <div class="tarjeta">
          <h4><i class="fas fa-user-times"></i> Dar de Baja Alumnos</h4>
          <div id="bajaAlumnosContenido"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // ===============================
  // DATOS DEL SISTEMA Y CONFIGURACI√ìN
  // ===============================

  // Datos para el horario mejorado
  const horarioData = {
      "Lunes": [
          { hora: "7:00-7:50", materia: "La energ√≠a en los procesos de la vida diaria" },
          { hora: "7:50-8:40", materia: "Temas selectos de ingl√©s 1" },
          { hora: "8:40-10:20", materia: "Psicolog√≠a 1" },
          { hora: "10:20-10:40", materia: "RECESO", esReceso: true },
          { hora: "10:40-11:30", materia: "Probabilidad y estad√≠stica" },
          { hora: "11:30-13:10", materia: "Actividades art√≠sticas y culturales 2" }
      ],
      "Martes": [
          { hora: "7:00-8:40", materia: "Temas selectos de ingl√©s 1" },
          { hora: "8:40-9:30", materia: "Psicolog√≠a 1" },
          { hora: "9:30-10:20", materia: "Conciencia hist√≥rica 2. M√©xico durante el expansi√≥nismo capitalista" },
          { hora: "10:20-10:40", materia: "RECESO", esReceso: true },
          { hora: "10:40-11:30", materia: "Sistemas de informaci√≥n" },
          { hora: "11:30-12:20", materia: "Orientaci√≥n educativa" },
          { hora: "12:20-13:10", materia: "Temas selectos de igualdad y derechos humanos 5" }
      ],
      "Mi√©rcoles": [
          { hora: "7:00-8:40", materia: "La energ√≠a en los procesos de la vida diaria" },
          { hora: "8:40-9:30", materia: "Pr√°ctica y colaboraci√≥n ciudadana 1" },
          { hora: "9:30-10:20", materia: "Conciencia hist√≥rica 2. M√©xico durante el expansi√≥nismo capitalista" },
          { hora: "10:20-10:40", materia: "RECESO", esReceso: true },
          { hora: "10:40-12:20", materia: "Probabilidad y estad√≠stica" }
      ],
      "Jueves": [
          { hora: "7:00-7:50", materia: "Orientaci√≥n educativa" },
          { hora: "7:50-8:40", materia: "Derecho 1" },
          { hora: "8:40-10:20", materia: "Programaci√≥n" },
          { hora: "10:20-10:40", materia: "RECESO", esReceso: true },
          { hora: "10:40-11:30", materia: "La energ√≠a en los procesos de la vida diaria" },
          { hora: "11:30-12:20", materia: "Conciencia hist√≥rica 2. M√©xico durante el expansi√≥nismo capitalista" }
      ],
      "Viernes": [
          { hora: "7:00-8:40", materia: "Programaci√≥n" },
          { hora: "8:40-10:20", materia: "Sistemas de informaci√≥n" },
          { hora: "10:20-10:40", materia: "RECESO", esReceso: true },
          { hora: "10:40-12:20", materia: "Derecho 1" }
      ]
  };

  const coloresMaterias = {
      "La energ√≠a en los procesos de la vida diaria": "#4CAF50",
      "Temas selectos de ingl√©s 1": "#2196F3",
      "Psicolog√≠a 1": "#9C27B0",
      "Probabilidad y estad√≠stica": "#FF9800",
      "Actividades art√≠sticas y culturales 2": "#E91E63",
      "Conciencia hist√≥rica 2. M√©xico durante el expansi√≥nismo capitalista": "#795548",
      "Sistemas de informaci√≥n": "#607D8B",
      "Orientaci√≥n educativa": "#009688",
      "Temas selectos de igualdad y derechos humanos 5": "#3F51B5",
      "Pr√°ctica y colaboraci√≥n ciudadana 1": "#FF5722",
      "Derecho 1": "#673AB7",
      "Programaci√≥n": "#00BCD4"
  };

  // Lista completa de materias
  const materias3o1 = [
    "La energ√≠a en los procesos de la vida diaria",
    "Temas selectos de ingl√©s 1", 
    "Psicolog√≠a 1",
    "Probabilidad y estad√≠stica",
    "Actividades art√≠sticas y culturales 2",
    "Conciencia hist√≥rica 2. M√©xico durante el expansi√≥nismo capitalista",
    "Sistemas de informaci√≥n",
    "Orientaci√≥n educativa",
    "Temas selectos de igualdad y derechos humanos 5",
    "Pr√°ctica y colaboraci√≥n ciudadana 1",
    "Derecho 1",
    "Programaci√≥n"
  ];

  // ===============================
  // DATOS DE PROFESORES ESPEC√çFICOS
  // ===============================

  const profesores = {
    "martin raul martinez calderon": { 
      password: "profe123", 
      nombre: "Mart√≠n Raul Martinez Calder√≥n",
      materias: [
        "La energ√≠a en los procesos de la vida diaria",
        "Programaci√≥n"
      ],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "nancy recendiz cortes": { 
      password: "profe123", 
      nombre: "Nancy Recendiz Cortes", 
      materias: [
        "Psicolog√≠a 1",
        "Conciencia hist√≥rica 2. M√©xico durante el expansi√≥nismo capitalista"
      ],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "juan jose sandoval santamaria": { 
      password: "profe123", 
      nombre: "Juan Jos√© Sandoval Santamar√≠a",
      materias: ["Probabilidad y estad√≠stica"], 
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "martin santiago gonzalez sanchez": { 
      password: "profe123", 
      nombre: "Mart√≠n Santiago Gonzalez Sanchez",
      materias: [
        "Actividades art√≠sticas y culturales 2",
        "Sistemas de informaci√≥n"
      ],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "erika elizabeth velazquez chora": { 
      password: "profe123", 
      nombre: "Erika Elizabeth Velazquez Chora",
      materias: ["Derecho 1"],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "claudia vega ya√±ez": { 
      password: "profe123", 
      nombre: "Claudia Vega Y√°√±ez",
      materias: ["Orientaci√≥n educativa"],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "virginia morales tellez": { 
      password: "profe123", 
      nombre: "Virginia Morales Tellez",
      materias: ["Pr√°ctica y colaboraci√≥n ciudadana 1"], 
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "america palau diaz": { 
      password: "profe123", 
      nombre: "America Palau Diaz",
      materias: ["Temas selectos de igualdad y derechos humanos 5"],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "sergio hernandez castillo": { 
      password: "profe123", 
      nombre: "Sergio Hernandez Castillo",
      materias: ["Temas selectos de ingl√©s 1"],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "reportes"]
    },
    "direccion": { 
      password: "admin123", 
      nombre: "Direcci√≥n Acad√©mica",
      materias: ["TODAS"],
      permisos: ["modificarCalificaciones", "asistencia", "tareas", "comunicados", "reportes", "bajaAlumnos"]
    }
  };

  // Funci√≥n para generar calificaciones en 0
  function generarCalificaciones() {
    const calificaciones = {
      semestre1: {},
      semestre2: {}
    };
    
    materias3o1.forEach(materia => {
      // Inicializar todos los parciales en 0 para ambos semestres
      calificaciones.semestre1[materia] = [0, 0, 0]; // [Parcial1, Parcial2, Parcial3]
      calificaciones.semestre2[materia] = [0, 0, 0]; // [Parcial1, Parcial2, Parcial3]
    });
    return calificaciones;
  }

  // Funci√≥n para calcular promedio de una materia
  function calcularPromedioMateria(parciales) {
    if (parciales.length === 0) return 0;
    const suma = parciales.reduce((a, b) => a + b, 0);
    return suma / parciales.length;
  }

  // Funci√≥n para calcular promedio general de un semestre
  function calcularPromedioSemestre(calificacionesSemestre) {
    let sumaTotal = 0;
    let materiasConCalificaciones = 0;
    
    for (const materia in calificacionesSemestre) {
      const promedioMateria = calcularPromedioMateria(calificacionesSemestre[materia]);
      if (promedioMateria > 0) {
        sumaTotal += promedioMateria;
        materiasConCalificaciones++;
      }
    }
    
    return materiasConCalificaciones > 0 ? sumaTotal / materiasConCalificaciones : 0;
  }

  // Funci√≥n para generar comentario basado en el promedio
  function generarComentario(promedio) {
    if (promedio >= 9.5) return "Excelencia acad√©mica sobresaliente";
    if (promedio >= 9.0) return "Excelente desempe√±o en todas las materias";
    if (promedio >= 8.5) return "Destacado desempe√±o acad√©mico";
    if (promedio >= 8.0) return "Buen desempe√±o general";
    if (promedio >= 7.5) return "Rendimiento satisfactorio y consistente";
    if (promedio >= 7.0) return "Desempe√±o adecuado, con √°reas de oportunidad";
    return "Atenci√≥n requerida en algunas materias";
  }

  // ALUMNOS COMPLETOS - LOS 43 ALUMNOS REALES
  let alumnos = {
    "31001": { 
      nombre: "ANAYA TORRES CRISTINA NOEMI", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31002": { 
      nombre: "BARCENAS GONZALEZ LUIS LEONARDO", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31003": { 
      nombre: "BARRIOS TORRES SANTIAGO EMMANUEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31004": { 
      nombre: "BOLA√ëOS PAZ DANIELA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31005": { 
      nombre: "CABALLERO CASTRO AXEL DANIEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31006": { 
      nombre: "CALVILLO CHAVARRIA YESENIA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31007": { 
      nombre: "CAMILO JUAREZ KARLA MADAI", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31008": { 
      nombre: "CASTANEDA BANUELOS EDUARDO ALEXANDER", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31009": { 
      nombre: "CASTELAN HERNANDEZ YECTEL YERIK", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31010": { 
      nombre: "CID MARTINEZ KEVIN", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31011": { 
      nombre: "CLAUDIO SANCHEZ DIEGO YAEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31012": { 
      nombre: "COLIN TORRES FERNANDO", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31013": { 
      nombre: "DELGADO MARTINEZ BETSABE", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31014": { 
      nombre: "ESQUIVEL ORDONEZ FERNANDA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31015": { 
      nombre: "FLORES ROMERO ABRIL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31016": { 
      nombre: "FUENTES VEGA ALONDRA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31017": { 
      nombre: "GANTES VARGAS MARCO GAEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31018": { 
      nombre: "GARCIA EMILIANO ISIS AILANI", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31019": { 
      nombre: "GARCIA SALAZAR KARON IRANHY", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31020": { 
      nombre: "GONZALEZ DIEGO ALIZETH", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31021": { 
      nombre: "GONZALEZ ZETINA JORGE LUIS", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31022": { 
      nombre: "LICEA ALVARADO LEILANI AZUL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31023": { 
      nombre: "LOPEZ MEJIA CHRISTIAN YAEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31024": { 
      nombre: "LOPEZ MOLINA VICTOR", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31025": { 
      nombre: "LOZANO RODRIGUEZ CRISTOPHER JAEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31026": { 
      nombre: "LUGO HERNANDEZ JAQUELINE", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31027": { 
      nombre: "MALDONADO CASTRO ASHLY NAOMI", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31028": { 
      nombre: "MARTINEZ MORELOS MARIANA SOLEIL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31029": { 
      nombre: "MARTINON ZU√ëIGA KELLY AYLIN", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31030": { 
      nombre: "MENDOZA MENDOZA LEONARDO YAEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31031": { 
      nombre: "MOCTEZUMA PACHECO YOALI SHERLYN", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31032": { 
      nombre: "OLGUIN RODRIGUEZ CARLOS IVAN", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31033": { 
      nombre: "OSORIO GARCIA LUZ ANGELICA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31034": { 
      nombre: "PAREDES CHAVEZ IOSHUA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31035": { 
      nombre: "PEREZ ROSARIO AMERICA PAOLA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31036": { 
      nombre: "PRIMERO PEREZ MARTHA EDITH", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31037": { 
      nombre: "RAMIREZ LUNA LEONARDO", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31038": { 
      nombre: "RODRIGUEZ GARCIA JOSE FERNANDO", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31039": { 
      nombre: "RODRIGUEZ GUTIERREZ CRISTELLE ESMERALDA", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31040": { 
      nombre: "ROMERO ROMERO YEREMI JEYDI", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31041": { 
      nombre: "RUIZ FUENTES SAID EMMANUEL", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31042": { 
      nombre: "SERRANO LOPEZ KARLA MONTSERRAT", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    },
    "31043": { 
      nombre: "VILLAR SALAZAR JENIFER YOSELIN", 
      calificaciones: generarCalificaciones(),
      grupo: "3¬∞1"
    }
  };

  // Generar comentarios basados en el promedio de cada alumno
  Object.keys(alumnos).forEach(codigo => {
    const alumno = alumnos[codigo];
    
    // Calcular promedio general (promedio de ambos semestres)
    const promedioSemestre1 = calcularPromedioSemestre(alumno.calificaciones.semestre1);
    const promedioSemestre2 = calcularPromedioSemestre(alumno.calificaciones.semestre2);
    const promedioGeneral = (promedioSemestre1 + promedioSemestre2) / 2;
    
    alumno.comentario = generarComentario(promedioGeneral);
    alumno.promedio = promedioGeneral.toFixed(2);
    alumno.promedioSemestre1 = promedioSemestre1.toFixed(2);
    alumno.promedioSemestre2 = promedioSemestre2.toFixed(2);
  });

  // ===============================
  // NUEVAS ESTRUCTURAS DE DATOS
  // ===============================

  // Sistema de asistencias
  let asistencias = {};
  
  // Sistema de comunicados
  let comunicados = [];
  
  // Sistema de tareas
  let tareas = [];
  
  // Sistema de recordatorios
  let recordatorios = [];

  // ===============================
  // PERSISTENCIA DE DATOS
  // ===============================

  // Cargar datos desde localStorage
  function cargarDatos() {
    const alumnosGuardados = localStorage.getItem('alumnos');
    const asistenciasGuardadas = localStorage.getItem('asistencias');
    const comunicadosGuardados = localStorage.getItem('comunicados');
    const tareasGuardadas = localStorage.getItem('tareas');
    const recordatoriosGuardados = localStorage.getItem('recordatorios');
    
    if (alumnosGuardados) alumnos = JSON.parse(alumnosGuardados);
    if (asistenciasGuardadas) asistencias = JSON.parse(asistenciasGuardadas);
    if (comunicadosGuardados) comunicados = JSON.parse(comunicadosGuardados);
    if (tareasGuardadas) tareas = JSON.parse(tareasGuardadas);
    if (recordatoriosGuardados) recordatorios = JSON.parse(recordatoriosGuardados);
  }

  // Guardar datos en localStorage
  function guardarDatos() {
    localStorage.setItem('alumnos', JSON.stringify(alumnos));
    localStorage.setItem('asistencias', JSON.stringify(asistencias));
    localStorage.setItem('comunicados', JSON.stringify(comunicados));
    localStorage.setItem('tareas', JSON.stringify(tareas));
    localStorage.setItem('recordatorios', JSON.stringify(recordatorios));
  }

  // ===============================
  // VARIABLES GLOBALES
  // ===============================

  let alumno = null;
  let maestro = "";
  let usuarioActual = "";
  let intentosFallidos = 0;
  const MAX_INTENTOS = 3;

  // ===============================
  // SISTEMA DE PERMISOS
  // ===============================

  function tienePermiso(permiso) {
    if (!usuarioActual || !profesores[usuarioActual]) return false;
    return profesores[usuarioActual].permisos.includes(permiso);
  }

  function verificarPermisosMenu() {
    const menuItems = document.querySelectorAll('#panelMaestro .menu-item');
    
    menuItems.forEach(item => {
      const texto = item.textContent.toLowerCase();
      
      if (texto.includes('comunicados') && !tienePermiso('comunicados')) {
        item.style.display = 'none';
      } else if (texto.includes('baja') && !tienePermiso('bajaAlumnos')) {
        item.style.display = 'none';
      } else if ((texto.includes('modificar calificaciones') || texto.includes('asistencia') || 
                 texto.includes('tareas') || texto.includes('reportes')) && 
                 !tienePermiso(texto.includes('calificaciones') ? 'modificarCalificaciones' :
                             texto.includes('asistencia') ? 'asistencia' :
                             texto.includes('tareas') ? 'tareas' : 'reportes')) {
        item.style.display = 'none';
      } else {
        item.style.display = 'flex';
      }
    });
  }

  // ===============================
  // FUNCIONES DE NAVEGACI√ìN
  // ===============================

  function mostrar(id) {
    document.querySelectorAll('.caja').forEach(c => c.classList.add('oculto'));
    document.getElementById(id).classList.remove('oculto');
    
    document.getElementById('errorAlumno').classList.add('oculto');
    document.getElementById('errorMaestro').classList.add('oculto');
    document.getElementById('intentosInfo').classList.add('oculto');
    
    if (id === 'loginAlumno') {
      document.getElementById('control').value = '';
    } else if (id === 'loginMaestro') {
      document.getElementById('maestro').value = '';
      document.getElementById('password').value = '';
    }
  }

  function volver() {
    mostrar("bienvenida");
  }

  // ===============================
  // SISTEMA DE LOGIN
  // ===============================

  // Login alumno
  function entrarAlumno() {
    const control = document.getElementById("control").value.trim();
    const errorAlumno = document.getElementById("errorAlumno");
    
    if (!control) {
      errorAlumno.textContent = "Por favor, ingresa tu n√∫mero de control";
      errorAlumno.classList.remove('oculto');
      return;
    }
    
    if (alumnos[control]) {
      alumno = alumnos[control];
      alumno.id = control;
      document.getElementById("sidebarNombreAlumno").textContent = alumno.nombre.split(' ')[0] + ' ' + alumno.nombre.split(' ')[1];
      cargarResumenAlumno();
      mostrar("panelAlumno");
    } else {
      errorAlumno.textContent = "N√∫mero de control no encontrado. Ejemplo: 31001";
      errorAlumno.classList.remove('oculto');
    }
  }

  // Login maestro
  function entrarMaestro() {
    const usuario = document.getElementById("maestro").value.trim().toLowerCase();
    const password = document.getElementById("password").value;
    const errorMaestro = document.getElementById("errorMaestro");
    const intentosInfo = document.getElementById("intentosInfo");
    
    if (!usuario || !password) {
      errorMaestro.textContent = "Por favor, completa todos los campos";
      errorMaestro.classList.remove('oculto');
      return;
    }
    
    if (intentosFallidos >= MAX_INTENTOS) {
      errorMaestro.textContent = "Demasiados intentos fallidos. Por favor, intente m√°s tarde.";
      errorMaestro.classList.remove('oculto');
      return;
    }
    
    if (profesores[usuario] && profesores[usuario].password === password) {
      maestro = profesores[usuario].nombre;
      usuarioActual = usuario;
      document.getElementById("sidebarNombreMaestro").textContent = maestro;
      cargarListaAlumnos();
      cargarSelectsAlumnos();
      verificarPermisosMenu();
      mostrar("panelMaestro");
      intentosFallidos = 0;
    } else {
      intentosFallidos++;
      const intentosRestantes = MAX_INTENTOS - intentosFallidos;
      
      errorMaestro.textContent = "Credenciales incorrectas.";
      errorMaestro.classList.remove('oculto');
      
      if (intentosRestantes > 0) {
        intentosInfo.textContent = `Te quedan ${intentosRestantes} intento(s)`;
        intentosInfo.classList.remove('oculto');
      } else {
        intentosInfo.textContent = "Has excedido el n√∫mero m√°ximo de intentos.";
        intentosInfo.classList.remove('oculto');
      }
    }
  }

  // ===============================
  // FUNCIONES PARA EL PANEL DEL ALUMNO
  // ===============================

  function cambiarSeccion(seccion) {
    // Actualizar men√∫ activo
    document.querySelectorAll('#panelAlumno .menu-item').forEach(item => {
      item.classList.remove('activo');
    });
    event.currentTarget.classList.add('activo');
    
    // Ocultar todas las secciones
    document.querySelectorAll('#panelAlumno .contenido-seccion').forEach(sec => {
      sec.classList.remove('activa');
    });
    
    // Mostrar secci√≥n seleccionada
    document.getElementById(seccion).classList.add('activa');
    
    // Cargar contenido seg√∫n la secci√≥n
    switch(seccion) {
      case 'resumen':
        cargarResumenAlumno();
        break;
      case 'horario':
        cargarHorarioAlumno();
        break;
      case 'calificaciones':
        cargarCalificacionesAlumno();
        break;
      case 'asistenciaAlumno':
        cargarAsistenciaAlumno();
        break;
      case 'comunicadosAlumno':
        cargarComunicadosAlumno();
        break;
      case 'tareasAlumno':
        cargarTareasAlumno();
        break;
      case 'datos':
        cargarDatosAlumno();
        break;
    }
  }

  function cargarResumenAlumno() {
    const promedioSem1 = parseFloat(alumno.promedioSemestre1);
    const promedioSem2 = parseFloat(alumno.promedioSemestre2);
    
    let html = `
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #2e7d32;">Promedio General</h4>
          <div style="font-size: 24px; font-weight: bold; color: #2e7d32;">${alumno.promedio}</div>
        </div>
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #1565c0;">Semestre 1</h4>
          <div style="font-size: 24px; font-weight: bold; color: #1565c0;">${alumno.promedioSemestre1}</div>
        </div>
        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #ef6c00;">Semestre 2</h4>
          <div style="font-size: 24px; font-weight: bold; color: #ef6c00;">${alumno.promedioSemestre2}</div>
        </div>
      </div>
      <div style="background: #f5f5f5; padding: 15px; border-radius: 8px;">
        <h5 style="margin-top: 0;">Comentario del Profesor</h5>
        <p style="margin: 0; font-style: italic;">"${alumno.comentario}"</p>
      </div>
    `;
    document.getElementById('resumenContenido').innerHTML = html;
    
    // Cargar recordatorios
    cargarRecordatoriosAlumno();
  }

  function cargarRecordatoriosAlumno() {
    let html = '';
    const hoy = new Date().toISOString().split('T')[0];
    
    // Recordatorios generales
    recordatorios.forEach(recordatorio => {
      if (recordatorio.fecha >= hoy) {
        html += `
          <div class="recordatorio">
            <strong>${recordatorio.titulo}</strong><br>
            ${recordatorio.descripcion}<br>
            <small>Fecha l√≠mite: ${recordatorio.fecha}</small>
          </div>
        `;
      }
    });
    
    // Tareas pendientes
    const tareasPendientes = tareas.filter(t => 
      t.para === alumno.id && t.estado === 'pendiente' && t.fechaEntrega >= hoy
    );
    
    if (tareasPendientes.length > 0) {
      html += `<div class="recordatorio" style="background: #d1ecf1; border-left-color: #17a2b8;">
        <strong><i class="fas fa-tasks"></i> Tareas Pendientes</strong><br>
        Tienes ${tareasPendientes.length} tarea(s) pendiente(s)
      </div>`;
    }
    
    document.getElementById('recordatoriosContenido').innerHTML = html || '<p>No hay recordatorios pendientes.</p>';
  }

  function cargarHorarioAlumno() {
    let html = `
        <div class="horario-mejorado">
            <div class="dias-semana">
    `;

    // Crear pesta√±as para cada d√≠a
    Object.keys(horarioData).forEach((dia, index) => {
        html += `
            <button class="dia-tab ${index === 0 ? 'activo' : ''}" onclick="cambiarDiaHorario('${dia}')">
                ${dia}
            </button>
        `;
    });

    html += `</div><div class="contenido-horario">`;

    // Crear contenido para cada d√≠a
    Object.keys(horarioData).forEach((dia, index) => {
        html += `
            <div class="dia-contenido ${index === 0 ? 'activo' : ''}" id="horario-${dia}">
                <h5 style="margin-top: 0; color: #2c3e50;">${dia}</h5>
                <div class="clases-lista">
        `;

        horarioData[dia].forEach((clase, idx) => {
            if (clase.esReceso) {
                html += `
                    <div class="clase-item receso">
                        <div class="hora-clase">${clase.hora}</div>
                        <div class="materia-clase">
                            <i class="fas fa-coffee"></i> ${clase.materia}
                        </div>
                    </div>
                `;
            } else {
                const color = coloresMaterias[clase.materia] || "#666";
                html += `
                    <div class="clase-item">
                        <div class="hora-clase">${clase.hora}</div>
                        <div class="materia-clase" style="border-left: 4px solid ${color}">
                            <div class="materia-nombre">${clase.materia}</div>
                            <div class="materia-color" style="background: ${color}"></div>
                        </div>
                    </div>
                `;
            }
        });

        html += `</div></div>`;
    });

    html += `</div></div>`;

    document.getElementById('horarioContenido').innerHTML = html;
  }

  function cargarCalificacionesAlumno() {
    let html = `
      <div class="semestres-tabs">
        <button class="semestre-tab activo" onclick="cambiarSemestreAlumno('semestre1')">
          <i class="fas fa-calendar-alt"></i> Semestre 1
        </button>
        <button class="semestre-tab" onclick="cambiarSemestreAlumno('semestre2')">
          <i class="fas fa-calendar-alt"></i> Semestre 2
        </button>
      </div>
      
      <div class="contenido-semestre activo" id="contenido-semestre1">
        <h5>Calificaciones - Semestre 1</h5>
        <div class="tabla-contenedor">
          <table class="tabla-calificaciones">
            <thead>
              <tr>
                <th>Materia</th>
                <th>Parcial 1</th>
                <th>Parcial 2</th>
                <th>Parcial 3</th>
                <th>Promedio</th>
              </tr>
            </thead>
            <tbody>
    `;
    
    for (const [materia, parciales] of Object.entries(alumno.calificaciones.semestre1)) {
      const promedio = calcularPromedioMateria(parciales);
      let claseCalif = 'media';
      if (promedio >= 9) claseCalif = 'alta';
      else if (promedio < 7) claseCalif = 'baja';
      
      html += `
        <tr>
          <td>${materia}</td>
          <td>${parciales[0]}</td>
          <td>${parciales[1]}</td>
          <td>${parciales[2]}</td>
          <td>
            <span class="calificacion ${claseCalif}">${promedio.toFixed(1)}</span>
          </td>
        </tr>
      `;
    }
    
    html += `
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="contenido-semestre" id="contenido-semestre2">
        <h5>Calificaciones - Semestre 2</h5>
        <div class="tabla-contenedor">
          <table class="tabla-calificaciones">
            <thead>
              <tr>
                <th>Materia</th>
                <th>Parcial 1</th>
                <th>Parcial 2</th>
                <th>Parcial 3</th>
                <th>Promedio</th>
              </tr>
            </thead>
            <tbody>
    `;
    
    for (const [materia, parciales] of Object.entries(alumno.calificaciones.semestre2)) {
      const promedio = calcularPromedioMateria(parciales);
      let claseCalif = 'media';
      if (promedio >= 9) claseCalif = 'alta';
      else if (promedio < 7) claseCalif = 'baja';
      
      html += `
        <tr>
          <td>${materia}</td>
          <td>${parciales[0]}</td>
          <td>${parciales[1]}</td>
          <td>${parciales[2]}</td>
          <td>
            <span class="calificacion ${claseCalif}">${promedio.toFixed(1)}</span>
          </td>
        </tr>
      `;
    }
    
    html += `
            </tbody>
          </table>
        </div>
      </div>
    `;
    
    document.getElementById('calificacionesContenido').innerHTML = html;
  }

  function cargarAsistenciaAlumno() {
    let html = '<h5>Registro de Asistencias</h5>';
    
    if (!asistencias[alumno.id]) {
      html += '<p>No hay registros de asistencia.</p>';
    } else {
      html += '<div style="max-height: 400px; overflow-y: auto;">';
      
      Object.entries(asistencias[alumno.id]).forEach(([fecha, estado]) => {
        let claseEstado = 'asistio';
        let textoEstado = 'Asisti√≥';
        
        if (estado === 'F') {
          claseEstado = 'falta';
          textoEstado = 'Falta';
        } else if (estado === 'R') {
          claseEstado = 'retardo';
          textoEstado = 'Retardo';
        }
        
        html += `
          <div style="display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee;">
            <span>${fecha}</span>
            <span class="estado-asistencia ${claseEstado}">${textoEstado}</span>
          </div>
        `;
      });
      
      html += '</div>';
    }
    
    document.getElementById('asistenciaAlumnoContenido').innerHTML = html;
  }

  function cargarComunicadosAlumno() {
    let html = '';
    
    if (comunicados.length === 0) {
      html = '<p>No hay comunicados.</p>';
    } else {
      comunicados.forEach(comunicado => {
        const claseImportante = comunicado.importante ? 'importante' : '';
        html += `
          <div class="comunicado ${claseImportante}">
            <div class="fecha">${comunicado.fecha} - ${comunicado.autor}</div>
            <h5 style="margin: 5px 0;">${comunicado.titulo}</h5>
            <p style="margin: 0;">${comunicado.mensaje}</p>
          </div>
        `;
      });
    }
    
    document.getElementById('comunicadosAlumnoContenido').innerHTML = html;
  }

  function cargarTareasAlumno() {
    let html = '<h5>Mis Tareas</h5>';
    const tareasAlumno = tareas.filter(t => t.para === alumno.id);
    
    if (tareasAlumno.length === 0) {
      html += '<p>No tienes tareas asignadas.</p>';
    } else {
      html += '<div style="max-height: 400px; overflow-y: auto;">';
      
      tareasAlumno.forEach(tarea => {
        const fecha = new Date(tarea.fechaEntrega);
        const hoy = new Date();
        const diffTime = fecha - hoy;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        let estadoColor = '#28a745';
        let estadoTexto = 'Completada';
        
        if (tarea.estado === 'pendiente') {
          estadoColor = diffDays < 0 ? '#dc3545' : (diffDays <= 3 ? '#ffc107' : '#17a2b8');
          estadoTexto = diffDays < 0 ? 'Vencida' : (diffDays <= 3 ? 'Pr√≥xima' : 'Pendiente');
        }
        
        html += `
          <div style="border-left: 4px solid ${estadoColor}; padding: 10px 15px; margin-bottom: 10px; background: white; border-radius: 0 5px 5px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <h6 style="margin: 0; flex: 1;">${tarea.titulo}</h6>
              <span style="background: ${estadoColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">
                ${estadoTexto}
              </span>
            </div>
            <p style="margin: 5px 0; font-size: 14px;">${tarea.descripcion}</p>
            <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6c757d;">
              <span>Entrega: ${tarea.fechaEntrega}</span>
              <span>Materia: ${tarea.materia}</span>
            </div>
            ${tarea.estado === 'pendiente' ? `
              <button class="btn-accion btn-info" onclick="marcarTareaCompletada('${tarea.id}')" style="margin-top: 8px;">
                <i class="fas fa-check"></i> Marcar como completada
              </button>
            ` : ''}
          </div>
        `;
      });
      
      html += '</div>';
    }
    
    document.getElementById('tareasAlumnoContenido').innerHTML = html;
  }

  function cargarDatosAlumno() {
    document.getElementById('datosContenido').innerHTML = `
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <strong>Nombre completo:</strong><br>
          ${alumno.nombre}
        </div>
        <div>
          <strong>N√∫mero de control:</strong><br>
          ${alumno.id}
        </div>
        <div>
          <strong>Grupo:</strong><br>
          ${alumno.grupo}
        </div>
        <div>
          <strong>Promedio general:</strong><br>
          ${alumno.promedio}
        </div>
      </div>
    `;
  }

  // ===============================
  // FUNCIONES PARA EL PANEL DEL MAESTRO
  // ===============================

  function cambiarSeccionMaestro(seccion) {
    // Verificar permisos antes de cambiar de secci√≥n
    const permisosRequeridos = {
      'listaAlumnos': 'asistencia',
      'modificarCalificaciones': 'modificarCalificaciones',
      'asistenciaMaestro': 'asistencia',
      'comunicadosMaestro': 'comunicados',
      'tareasMaestro': 'tareas',
      'reportesMaestro': 'reportes',
      'bajaAlumnos': 'bajaAlumnos'
    };
    
    if (permisosRequeridos[seccion] && !tienePermiso(permisosRequeridos[seccion])) {
      alert('No tienes permisos para acceder a esta secci√≥n');
      return;
    }
    
    // Actualizar men√∫ activo
    document.querySelectorAll('#panelMaestro .menu-item').forEach(item => {
      item.classList.remove('activo');
    });
    event.currentTarget.classList.add('activo');
    
    // Ocultar todas las secciones
    document.querySelectorAll('#panelMaestro .contenido-seccion').forEach(sec => {
      sec.classList.remove('activa');
    });
    
    // Mostrar secci√≥n seleccionada
    document.getElementById(seccion).classList.add('activa');
    
    // Cargar contenido seg√∫n la secci√≥n
    switch(seccion) {
      case 'listaAlumnos':
        cargarListaAlumnos();
        break;
      case 'modificarCalificaciones':
        cargarModificarCalificaciones();
        break;
      case 'asistenciaMaestro':
        cargarAsistenciaMaestro();
        break;
      case 'comunicadosMaestro':
        cargarComunicadosMaestro();
        break;
      case 'tareasMaestro':
        cargarTareasMaestro();
        break;
      case 'reportesMaestro':
        cargarReportesMaestro();
        break;
      case 'bajaAlumnos':
        cargarBajaAlumnos();
        break;
    }
  }

  function cargarListaAlumnos() {
    let html = `
      <div class="tabla-contenedor">
        <table>
          <thead>
            <tr>
              <th>N¬∞ Control</th>
              <th>Nombre</th>
              <th>Promedio</th>
              <th>Semestre 1</th>
              <th>Semestre 2</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
    `;
    
    for (const [codigo, alum] of Object.entries(alumnos)) {
      const promedio = alum.promedio;
      const estado = promedio >= 8 ? 'Aprobado' : promedio >= 6 ? 'Regular' : 'En riesgo';
      
      html += `
        <tr>
          <td>${codigo}</td>
          <td>${alum.nombre}</td>
          <td>${promedio}</td>
          <td>${alum.promedioSemestre1}</td>
          <td>${alum.promedioSemestre2}</td>
          <td>${estado}</td>
        </tr>
      `;
    }
    
    html += `
          </tbody>
        </table>
      </div>
    `;
    
    document.getElementById('listaAlumnosContenido').innerHTML = html;
  }

  function cargarModificarCalificaciones() {
    document.getElementById('modificarCalificacionesContenido').innerHTML = `
      <p>Seleccione un alumno para modificar sus calificaciones:</p>
      <div class="form-group">
        <select id="selectAlumnoCalificaciones" onchange="cargarFormularioCalificaciones()">
          <option value="">-- Seleccione un alumno --</option>
        </select>
      </div>
      <div id="formularioCalificaciones" style="display: none;"></div>
    `;
    
    // Llenar el select con los alumnos
    const select = document.getElementById('selectAlumnoCalificaciones');
    select.innerHTML = '<option value="">-- Seleccione un alumno --</option>';
    
    for (const [codigo, alum] of Object.entries(alumnos)) {
      const option = document.createElement('option');
      option.value = codigo;
      option.textContent = `${codigo} - ${alum.nombre}`;
      select.appendChild(option);
    }
  }

  function cargarFormularioCalificaciones() {
    const codigo = document.getElementById('selectAlumnoCalificaciones').value;
    if (!codigo) {
      document.getElementById('formularioCalificaciones').style.display = 'none';
      return;
    }
    
    const alum = alumnos[codigo];
    const materiasDelProfesor = profesores[usuarioActual]?.materias || [];
    const mostrarTodas = materiasDelProfesor.includes("TODAS");
    
    let html = `
      <div class="formulario-calificaciones">
        <h5>Editando calificaciones de: ${alum.nombre}</h5>
        
        <div class="semestres-tabs">
          <button class="semestre-tab activo" onclick="cambiarSemestreCalificaciones('semestre1')">
            <i class="fas fa-calendar-alt"></i> Semestre 1
          </button>
          <button class="semestre-tab" onclick="cambiarSemestreCalificaciones('semestre2')">
            <i class="fas fa-calendar-alt"></i> Semestre 2
          </button>
        </div>
        
        <div class="parciales-tabs">
          <button class="parcial-tab activo" onclick="cambiarParcialCalificaciones(1)">Parcial 1</button>
          <button class="parcial-tab" onclick="cambiarParcialCalificaciones(2)">Parcial 2</button>
          <button class="parcial-tab" onclick="cambiarParcialCalificaciones(3)">Parcial 3</button>
        </div>
        
        <div id="contenido-calificaciones">
    `;
    
    // Contenido para Semestre 1 - Parcial 1
    html += `<div class="contenido-parcial activo" id="semestre1-parcial1">`;
    for (const [materia, parciales] of Object.entries(alum.calificaciones.semestre1)) {
      // Filtrar materias seg√∫n los permisos del profesor
      if (!mostrarTodas && !materiasDelProfesor.includes(materia)) {
        continue;
      }
      
      const materiaId = materia.replace(/[^\w]/g, '_');
      html += `
        <div class="materia-calificacion">
          <label for="calif-${codigo}-sem1-p1-${materiaId}">${materia}</label>
          <input type="number" min="0" max="10" step="0.1" value="${parciales[0]}" 
                 id="calif-${codigo}-sem1-p1-${materiaId}" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
        </div>
      `;
    }
    html += `</div>`;
    
    // Contenido para Semestre 1 - Parcial 2
    html += `<div class="contenido-parcial" id="semestre1-parcial2">`;
    for (const [materia, parciales] of Object.entries(alum.calificaciones.semestre1)) {
      if (!mostrarTodas && !materiasDelProfesor.includes(materia)) {
        continue;
      }
      
      const materiaId = materia.replace(/[^\w]/g, '_');
      html += `
        <div class="materia-calificacion">
          <label for="calif-${codigo}-sem1-p2-${materiaId}">${materia}</label>
          <input type="number" min="0" max="10" step="0.1" value="${parciales[1]}" 
                 id="calif-${codigo}-sem1-p2-${materiaId}" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
        </div>
      `;
    }
    html += `</div>`;
    
    // Contenido para Semestre 1 - Parcial 3
    html += `<div class="contenido-parcial" id="semestre1-parcial3">`;
    for (const [materia, parciales] of Object.entries(alum.calificaciones.semestre1)) {
      if (!mostrarTodas && !materiasDelProfesor.includes(materia)) {
        continue;
      }
      
      const materiaId = materia.replace(/[^\w]/g, '_');
      html += `
        <div class="materia-calificacion">
          <label for="calif-${codigo}-sem1-p3-${materiaId}">${materia}</label>
          <input type="number" min="0" max="10" step="0.1" value="${parciales[2]}" 
                 id="calif-${codigo}-sem1-p3-${materiaId}" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
        </div>
      `;
    }
    html += `</div>`;
    
    // Contenido para Semestre 2 - Parcial 1
    html += `<div class="contenido-parcial" id="semestre2-parcial1">`;
    for (const [materia, parciales] of Object.entries(alum.calificaciones.semestre2)) {
      if (!mostrarTodas && !materiasDelProfesor.includes(materia)) {
        continue;
      }
      
      const materiaId = materia.replace(/[^\w]/g, '_');
      html += `
        <div class="materia-calificacion">
          <label for="calif-${codigo}-sem2-p1-${materiaId}">${materia}</label>
          <input type="number" min="0" max="10" step="0.1" value="${parciales[0]}" 
                 id="calif-${codigo}-sem2-p1-${materiaId}" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
        </div>
      `;
    }
    html += `</div>`;
    
    // Contenido para Semestre 2 - Parcial 2
    html += `<div class="contenido-parcial" id="semestre2-parcial2">`;
    for (const [materia, parciales] of Object.entries(alum.calificaciones.semestre2)) {
      if (!mostrarTodas && !materiasDelProfesor.includes(materia)) {
        continue;
      }
      
      const materiaId = materia.replace(/[^\w]/g, '_');
      html += `
        <div class="materia-calificacion">
          <label for="calif-${codigo}-sem2-p2-${materiaId}">${materia}</label>
          <input type="number" min="0" max="10" step="0.1" value="${parciales[1]}" 
                 id="calif-${codigo}-sem2-p2-${materiaId}" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
        </div>
      `;
    }
    html += `</div>`;
    
    // Contenido para Semestre 2 - Parcial 3
    html += `<div class="contenido-parcial" id="semestre2-parcial3">`;
    for (const [materia, parciales] of Object.entries(alum.calificaciones.semestre2)) {
      if (!mostrarTodas && !materiasDelProfesor.includes(materia)) {
        continue;
      }
      
      const materiaId = materia.replace(/[^\w]/g, '_');
      html += `
        <div class="materia-calificacion">
          <label for="calif-${codigo}-sem2-p3-${materiaId}">${materia}</label>
          <input type="number" min="0" max="10" step="0.1" value="${parciales[2]}" 
                 id="calif-${codigo}-sem2-p3-${materiaId}" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
        </div>
      `;
    }
    html += `</div>`;
    
    if (Object.keys(alum.calificaciones.semestre1).filter(materia => 
      mostrarTodas || materiasDelProfesor.includes(materia)
    ).length === 0) {
      html += `<p>No tienes materias asignadas para modificar calificaciones.</p>`;
    } else {
      html += `
        <div style="margin-top: 20px;">
          <button class="btn-accion btn-editar" onclick="guardarCalificaciones('${codigo}')" ${!tienePermiso('modificarCalificaciones') ? 'disabled' : ''}>
            <i class="fas fa-save"></i> Guardar Cambios
          </button>
        </div>
      `;
    }
    
    html += `</div></div>`;
    
    document.getElementById('formularioCalificaciones').innerHTML = html;
    document.getElementById('formularioCalificaciones').style.display = 'block';
  }

  function cargarAsistenciaMaestro() {
    const fechaHoy = new Date().toISOString().split('T')[0];
    
    let html = `
      <div class="form-group">
        <label>Fecha de asistencia:</label>
        <input type="date" id="fechaAsistencia" value="${fechaHoy}">
      </div>
      <div class="tabla-contenedor">
        <table>
          <thead>
            <tr>
              <th>N¬∞ Control</th>
              <th>Nombre</th>
              <th>Asistencia</th>
            </tr>
          </thead>
          <tbody>
    `;
    
    for (const [codigo, alum] of Object.entries(alumnos)) {
      const asistenciaHoy = asistencias[codigo] && asistencias[codigo][fechaHoy] ? asistencias[codigo][fechaHoy] : '';
      
      html += `
        <tr>
          <td>${codigo}</td>
          <td>${alum.nombre}</td>
          <td>
            <select id="asistencia-${codigo}" onchange="actualizarAsistencia('${codigo}')" ${!tienePermiso('asistencia') ? 'disabled' : ''}>
              <option value="A" ${asistenciaHoy === 'A' ? 'selected' : ''}>Asisti√≥</option>
              <option value="F" ${asistenciaHoy === 'F' ? 'selected' : ''}>Falta</option>
              <option value="R" ${asistenciaHoy === 'R' ? 'selected' : ''}>Retardo</option>
            </select>
          </td>
        </tr>
      `;
    }
    
    html += `
          </tbody>
        </table>
      </div>
      <button class="btn-accion btn-editar" onclick="guardarTodasAsistencias()" style="margin-top: 15px;" ${!tienePermiso('asistencia') ? 'disabled' : ''}>
        <i class="fas fa-save"></i> Guardar Todas las Asistencias
      </button>
    `;
    
    document.getElementById('asistenciaMaestroContenido').innerHTML = html;
  }

  function cargarComunicadosMaestro() {
    let html = `
      <div class="form-group">
        <label>T√≠tulo del comunicado:</label>
        <input type="text" id="tituloComunicado" placeholder="Ingrese el t√≠tulo" ${!tienePermiso('comunicados') ? 'disabled' : ''}>
      </div>
      <div class="form-group">
        <label>Mensaje:</label>
        <textarea id="mensajeComunicado" rows="4" placeholder="Ingrese el mensaje" ${!tienePermiso('comunicados') ? 'disabled' : ''}></textarea>
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" id="importanteComunicado" ${!tienePermiso('comunicados') ? 'disabled' : ''}> Marcar como importante
        </label>
      </div>
      <button class="btn-accion btn-editar" onclick="crearComunicado()" ${!tienePermiso('comunicados') ? 'disabled' : ''}>
        <i class="fas fa-paper-plane"></i> Enviar Comunicado
      </button>
      
      <div style="margin-top: 30px;">
        <h5>Comunicados Anteriores</h5>
    `;
    
    if (comunicados.length === 0) {
      html += '<p>No hay comunicados enviados.</p>';
    } else {
      comunicados.forEach((comunicado, index) => {
        const claseImportante = comunicado.importante ? 'importante' : '';
        html += `
          <div class="comunicado ${claseImportante}">
            <div class="fecha">${comunicado.fecha} - ${comunicado.autor}</div>
            <h5 style="margin: 5px 0;">${comunicado.titulo}</h5>
            <p style="margin: 0;">${comunicado.mensaje}</p>
            <button class="btn-accion btn-eliminar" onclick="eliminarComunicado(${index})" style="margin-top: 10px;" ${!tienePermiso('comunicados') ? 'disabled' : ''}>
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        `;
      });
    }
    
    html += '</div>';
    document.getElementById('comunicadosMaestroContenido').innerHTML = html;
  }

  function cargarTareasMaestro() {
    let html = `
      <div class="form-group">
        <label>T√≠tulo de la tarea:</label>
        <input type="text" id="tituloTarea" placeholder="Ingrese el t√≠tulo de la tarea" ${!tienePermiso('tareas') ? 'disabled' : ''}>
      </div>
      <div class="form-group">
        <label>Descripci√≥n:</label>
        <textarea id="descripcionTarea" rows="3" placeholder="Ingrese la descripci√≥n" ${!tienePermiso('tareas') ? 'disabled' : ''}></textarea>
      </div>
      <div class="form-group">
        <label>Materia:</label>
        <select id="materiaTarea" ${!tienePermiso('tareas') ? 'disabled' : ''}>
          <option value="">-- Seleccione materia --</option>
          ${materias3o1.map(materia => `<option value="${materia}">${materia}</option>`).join('')}
        </select>
      </div>
      <div class="form-group">
        <label>Fecha de entrega:</label>
        <input type="date" id="fechaTarea" ${!tienePermiso('tareas') ? 'disabled' : ''}>
      </div>
      <div class="form-group">
        <label>Asignar a:</label>
        <select id="destinatarioTarea" ${!tienePermiso('tareas') ? 'disabled' : ''}>
          <option value="todos">Todos los alumnos</option>
          ${Object.entries(alumnos).map(([codigo, alum]) => 
            `<option value="${codigo}">${codigo} - ${alum.nombre}</option>`
          ).join('')}
        </select>
      </div>
      <button class="btn-accion btn-editar" onclick="crearTarea()" ${!tienePermiso('tareas') ? 'disabled' : ''}>
        <i class="fas fa-plus"></i> Crear Tarea
      </button>
      
      <div style="margin-top: 30px;">
        <h5>Tareas Asignadas</h5>
    `;
    
    if (tareas.length === 0) {
      html += '<p>No hay tareas asignadas.</p>';
    } else {
      html += '<div style="max-height: 400px; overflow-y: auto;">';
      
      tareas.forEach((tarea, index) => {
        const destinatario = tarea.para === 'todos' ? 'Todos' : `${tarea.para} - ${alumnos[tarea.para]?.nombre || 'Alumno'}`;
        
        html += `
          <div style="border-left: 4px solid #3498db; padding: 10px 15px; margin-bottom: 10px; background: white; border-radius: 0 5px 5px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <h6 style="margin: 0; flex: 1;">${tarea.titulo}</h6>
              <span style="background: ${tarea.estado === 'completada' ? '#28a745' : '#17a2b8'}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">
                ${tarea.estado === 'completada' ? 'Completada' : 'Pendiente'}
              </span>
            </div>
            <p style="margin: 5px 0; font-size: 14px;">${tarea.descripcion}</p>
            <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6c757d;">
              <span>Entrega: ${tarea.fechaEntrega}</span>
              <span>Materia: ${tarea.materia}</span>
              <span>Para: ${destinatario}</span>
            </div>
            <button class="btn-accion btn-eliminar" onclick="eliminarTarea(${index})" style="margin-top: 8px;" ${!tienePermiso('tareas') ? 'disabled' : ''}>
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        `;
      });
      
      html += '</div>';
    }
    
    html += '</div>';
    document.getElementById('tareasMaestroContenido').innerHTML = html;
  }

  function cargarReportesMaestro() {
    // Calcular estad√≠sticas
    const totalAlumnos = Object.keys(alumnos).length;
    
    // Calcular promedios generales
    const promedios = Object.values(alumnos).map(a => parseFloat(a.promedio));
    const promedioGeneral = (promedios.reduce((a, b) => a + b, 0) / promedios.length).toFixed(2);
    
    // Calcular promedios por semestre
    const promediosSem1 = Object.values(alumnos).map(a => parseFloat(a.promedioSemestre1));
    const promedioSem1 = (promediosSem1.reduce((a, b) => a + b, 0) / promediosSem1.length).toFixed(2);
    
    const promediosSem2 = Object.values(alumnos).map(a => parseFloat(a.promedioSemestre2));
    const promedioSem2 = (promediosSem2.reduce((a, b) => a + b, 0) / promediosSem2.length).toFixed(2);
    
    const alumnosAprobados = Object.values(alumnos).filter(a => parseFloat(a.promedio) >= 8).length;
    const alumnosRegulares = Object.values(alumnos).filter(a => parseFloat(a.promedio) >= 6 && parseFloat(a.promedio) < 8).length;
    const alumnosRiesgo = Object.values(alumnos).filter(a => parseFloat(a.promedio) < 6).length;
    
    // Estad√≠sticas de asistencia
    let totalAsistencias = 0, totalFaltas = 0, totalRetardos = 0;
    Object.values(asistencias).forEach(alumAsist => {
      Object.values(alumAsist).forEach(estado => {
        if (estado === 'A') totalAsistencias++;
        else if (estado === 'F') totalFaltas++;
        else if (estado === 'R') totalRetardos++;
      });
    });
    
    const totalRegistros = totalAsistencias + totalFaltas + totalRetardos;
    const porcentajeAsistencia = totalRegistros > 0 ? ((totalAsistencias / totalRegistros) * 100).toFixed(1) : 0;
    
    let html = `
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #2e7d32;">Promedio General</h4>
          <div style="font-size: 24px; font-weight: bold; color: #2e7d32;">${promedioGeneral}</div>
        </div>
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #1565c0;">Semestre 1</h4>
          <div style="font-size: 24px; font-weight: bold; color: #1565c0;">${promedioSem1}</div>
        </div>
        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #ef6c00;">Semestre 2</h4>
          <div style="font-size: 24px; font-weight: bold; color: #ef6c00;">${promedioSem2}</div>
        </div>
        <div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center;">
          <h4 style="margin: 0; color: #721c24;">% Asistencia</h4>
          <div style="font-size: 24px; font-weight: bold; color: #721c24;">${porcentajeAsistencia}%</div>
        </div>
      </div>
      
      <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
          <h5>Estado Acad√©mico</h5>
          <div class="estadistica">
            <span>Aprobados (‚â•8.0):</span>
            <span>${alumnosAprobados} (${((alumnosAprobados / totalAlumnos) * 100).toFixed(1)}%)</span>
          </div>
          <div class="estadistica">
            <span>Regulares (6.0-7.9):</span>
            <span>${alumnosRegulares} (${((alumnosRegulares / totalAlumnos) * 100).toFixed(1)}%)</span>
          </div>
          <div class="estadistica">
            <span>En riesgo (<6.0):</span>
            <span>${alumnosRiesgo} (${((alumnosRiesgo / totalAlumnos) * 100).toFixed(1)}%)</span>
          </div>
        </div>
        
        <div>
          <h5>Asistencia General</h5>
          <div class="estadistica">
            <span>Asistencias:</span>
            <span>${totalAsistencias} (${totalRegistros > 0 ? ((totalAsistencias / totalRegistros) * 100).toFixed(1) : 0}%)</span>
          </div>
          <div class="estadistica">
            <span>Faltas:</span>
            <span>${totalFaltas} (${totalRegistros > 0 ? ((totalFaltas / totalRegistros) * 100).toFixed(1) : 0}%)</span>
          </div>
          <div class="estadistica">
            <span>Retardos:</span>
            <span>${totalRetardos} (${totalRegistros > 0 ? ((totalRetardos / totalRegistros) * 100).toFixed(1) : 0}%)</span>
          </div>
        </div>
      </div>
      
      <div style="margin-top: 20px;">
        <h5>Top 5 Mejores Promedios</h5>
        <div class="tabla-contenedor">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Alumno</th>
                <th>Promedio</th>
                <th>Semestre 1</th>
                <th>Semestre 2</th>
              </tr>
            </thead>
            <tbody>
    `;
    
    // Ordenar alumnos por promedio
    const topAlumnos = Object.entries(alumnos)
      .map(([codigo, alum]) => ({ 
        codigo, 
        nombre: alum.nombre, 
        promedio: parseFloat(alum.promedio),
        sem1: parseFloat(alum.promedioSemestre1),
        sem2: parseFloat(alum.promedioSemestre2)
      }))
      .sort((a, b) => b.promedio - a.promedio)
      .slice(0, 5);
    
    topAlumnos.forEach((alum, index) => {
      html += `
        <tr>
          <td>${index + 1}</td>
          <td>${alum.nombre}</td>
          <td>${alum.promedio.toFixed(2)}</td>
          <td>${alum.sem1.toFixed(2)}</td>
          <td>${alum.sem2.toFixed(2)}</td>
        </tr>
      `;
    });
    
    html += `
            </tbody>
          </table>
        </div>
      </div>
    `;
    
    document.getElementById('reportesMaestroContenido').innerHTML = html;
  }

  function cargarBajaAlumnos() {
    document.getElementById('bajaAlumnosContenido').innerHTML = `
      <p>Seleccione un alumno para darle de baja del sistema:</p>
      <div class="form-group">
        <select id="selectAlumnoBaja" ${!tienePermiso('bajaAlumnos') ? 'disabled' : ''}>
          <option value="">-- Seleccione un alumno --</option>
        </select>
      </div>
      <button class="btn-accion btn-eliminar" onclick="confirmarBaja()" ${!tienePermiso('bajaAlumnos') ? 'disabled' : ''}>
        <i class="fas fa-trash"></i> Dar de Baja Alumno Seleccionado
      </button>
      <div id="infoBaja" style="margin-top: 15px;"></div>
    `;
    
    // Llenar el select con los alumnos
    const select = document.getElementById('selectAlumnoBaja');
    select.innerHTML = '<option value="">-- Seleccione un alumno --</option>';
    
    for (const [codigo, alum] of Object.entries(alumnos)) {
      const option = document.createElement('option');
      option.value = codigo;
      option.textContent = `${codigo} - ${alum.nombre}`;
      select.appendChild(option);
    }
  }

  // ===============================
  // FUNCIONES AUXILIARES MAESTRO
  // ===============================

  function cargarSelectsAlumnos() {
    cargarModificarCalificaciones();
    cargarBajaAlumnos();
  }

  // Variables para controlar el semestre y parcial actual
  let semestreActual = 'semestre1';
  let parcialActual = 1;

  function cambiarSemestreCalificaciones(semestre) {
    semestreActual = semestre;
    
    // Actualizar pesta√±as de semestre
    document.querySelectorAll('.semestre-tab').forEach(tab => {
      tab.classList.remove('activo');
    });
    event.currentTarget.classList.add('activo');
    
    // Actualizar contenido seg√∫n el semestre y parcial actual
    cambiarParcialCalificaciones(parcialActual);
  }

  function cambiarParcialCalificaciones(parcial) {
    parcialActual = parcial;
    
    // Actualizar pesta√±as de parcial
    document.querySelectorAll('.parcial-tab').forEach(tab => {
      tab.classList.remove('activo');
    });
    
    // Encontrar el bot√≥n correcto del parcial
    const tabs = document.querySelectorAll('.parcial-tab');
    tabs[parcial - 1].classList.add('activo');
    
    // Ocultar todos los contenidos de parcial
    document.querySelectorAll('.contenido-parcial').forEach(contenido => {
      contenido.classList.remove('activo');
    });
    
    // Mostrar el contenido correspondiente
    const contenidoId = `${semestreActual}-parcial${parcial}`;
    document.getElementById(contenidoId).classList.add('activo');
  }

  function guardarCalificaciones(codigo) {
    if (!tienePermiso('modificarCalificaciones')) {
      alert('No tienes permisos para modificar calificaciones');
      return;
    }
    
    const alum = alumnos[codigo];
    let cambiosRealizados = false;
    
    // Guardar calificaciones para ambos semestres y los tres parciales
    for (const semestre of ['semestre1', 'semestre2']) {
      for (let parcial = 1; parcial <= 3; parcial++) {
        for (const materia of Object.keys(alum.calificaciones[semestre])) {
          const materiaId = materia.replace(/[^\w]/g, '_');
          const inputId = `calif-${codigo}-${semestre}-p${parcial}-${materiaId}`;
          const input = document.getElementById(inputId);
          
          if (input) {
            const nuevaCalif = parseFloat(input.value) || 0;
            if (nuevaCalif !== alum.calificaciones[semestre][materia][parcial - 1]) {
              alum.calificaciones[semestre][materia][parcial - 1] = nuevaCalif;
              cambiosRealizados = true;
            }
          }
        }
      }
    }
    
    if (cambiosRealizados) {
      // Recalcular promedios y comentario
      const promedioSemestre1 = calcularPromedioSemestre(alum.calificaciones.semestre1);
      const promedioSemestre2 = calcularPromedioSemestre(alum.calificaciones.semestre2);
      const promedioGeneral = (promedioSemestre1 + promedioSemestre2) / 2;
      
      alum.promedio = promedioGeneral.toFixed(2);
      alum.promedioSemestre1 = promedioSemestre1.toFixed(2);
      alum.promedioSemestre2 = promedioSemestre2.toFixed(2);
      alum.comentario = generarComentario(promedioGeneral);
      
      alert('Calificaciones actualizadas correctamente');
      cargarListaAlumnos();
      guardarDatos();
    } else {
      alert('No se realizaron cambios');
    }
  }

  function actualizarAsistencia(codigo) {
    if (!tienePermiso('asistencia')) {
      alert('No tienes permisos para modificar asistencia');
      return;
    }
    
    const fecha = document.getElementById('fechaAsistencia').value;
    const estado = document.getElementById(`asistencia-${codigo}`).value;
    
    if (!asistencias[codigo]) {
      asistencias[codigo] = {};
    }
    
    asistencias[codigo][fecha] = estado;
    guardarDatos();
  }

  function guardarTodasAsistencias() {
    if (!tienePermiso('asistencia')) {
      alert('No tienes permisos para guardar asistencias');
      return;
    }
    
    alert('Todas las asistencias han sido guardadas correctamente');
    guardarDatos();
  }

  function crearComunicado() {
    if (!tienePermiso('comunicados')) {
      alert('No tienes permisos para enviar comunicados');
      return;
    }
    
    const titulo = document.getElementById('tituloComunicado').value;
    const mensaje = document.getElementById('mensajeComunicado').value;
    const importante = document.getElementById('importanteComunicado').checked;
    
    if (!titulo || !mensaje) {
      alert('Por favor, complete todos los campos');
      return;
    }
    
    const comunicado = {
      fecha: new Date().toISOString().split('T')[0],
      titulo: titulo,
      mensaje: mensaje,
      autor: maestro,
      importante: importante
    };
    
    comunicados.unshift(comunicado);
    guardarDatos();
    
    // Limpiar formulario
    document.getElementById('tituloComunicado').value = '';
    document.getElementById('mensajeComunicado').value = '';
    document.getElementById('importanteComunicado').checked = false;
    
    alert('Comunicado enviado correctamente');
    cargarComunicadosMaestro();
  }

  function eliminarComunicado(index) {
    if (!tienePermiso('comunicados')) {
      alert('No tienes permisos para eliminar comunicados');
      return;
    }
    
    if (confirm('¬øEst√° seguro de que desea eliminar este comunicado?')) {
      comunicados.splice(index, 1);
      guardarDatos();
      cargarComunicadosMaestro();
    }
  }

  function crearTarea() {
    if (!tienePermiso('tareas')) {
      alert('No tienes permisos para asignar tareas');
      return;
    }
    
    const titulo = document.getElementById('tituloTarea').value;
    const descripcion = document.getElementById('descripcionTarea').value;
    const materia = document.getElementById('materiaTarea').value;
    const fecha = document.getElementById('fechaTarea').value;
    const destinatario = document.getElementById('destinatarioTarea').value;
    
    if (!titulo || !descripcion || !materia || !fecha) {
      alert('Por favor, complete todos los campos');
      return;
    }
    
    const tarea = {
      id: Date.now().toString(),
      titulo: titulo,
      descripcion: descripcion,
      materia: materia,
      fechaEntrega: fecha,
      para: destinatario,
      estado: 'pendiente',
      fechaCreacion: new Date().toISOString().split('T')[0]
    };
    
    tareas.unshift(tarea);
    guardarDatos();
    
    // Limpiar formulario
    document.getElementById('tituloTarea').value = '';
    document.getElementById('descripcionTarea').value = '';
    document.getElementById('materiaTarea').value = '';
    document.getElementById('fechaTarea').value = '';
    document.getElementById('destinatarioTarea').value = 'todos';
    
    alert('Tarea creada correctamente');
    cargarTareasMaestro();
  }

  function eliminarTarea(index) {
    if (!tienePermiso('tareas')) {
      alert('No tienes permisos para eliminar tareas');
      return;
    }
    
    if (confirm('¬øEst√° seguro de que desea eliminar esta tarea?')) {
      tareas.splice(index, 1);
      guardarDatos();
      cargarTareasMaestro();
    }
  }

  function confirmarBaja() {
    if (!tienePermiso('bajaAlumnos')) {
      alert('No tienes permisos para dar de baja alumnos');
      return;
    }
    
    const codigo = document.getElementById('selectAlumnoBaja').value;
    if (!codigo) {
      alert('Por favor, seleccione un alumno');
      return;
    }
    
    const alum = alumnos[codigo];
    
    if (confirm(`¬øEst√° seguro de que desea dar de baja a ${alum.nombre}? Esta acci√≥n no se puede deshacer.`)) {
      delete alumnos[codigo];
      alert('Alumno dado de baja correctamente');
      cargarListaAlumnos();
      cargarSelectsAlumnos();
      guardarDatos();
      document.getElementById('infoBaja').innerHTML = `
        <div style="background: #d4edda; padding: 10px; border-radius: 5px; border-left: 4px solid #28a745;">
          <strong>Alumno eliminado:</strong> ${alum.nombre}
        </div>
      `;
    }
  }

  // ===============================
  // FUNCIONES PARA TAREAS (ALUMNO)
  // ===============================

  function marcarTareaCompletada(tareaId) {
    const tarea = tareas.find(t => t.id === tareaId);
    if (tarea) {
      tarea.estado = 'completada';
      guardarDatos();
      cargarTareasAlumno();
      cargarRecordatoriosAlumno();
      alert('Tarea marcada como completada');
    }
  }

  // ===============================
  // FUNCIONES UTILITARIAS
  // ===============================

  function cerrar() {
    alumno = null;
    maestro = "";
    usuarioActual = "";
    alert("Sesi√≥n cerrada.");
    volver();
  }

  // ===============================
  // FUNCIONES PARA EL HORARIO MEJORADO
  // ===============================

  function cambiarDiaHorario(dia) {
    // Actualizar pesta√±as activas
    document.querySelectorAll('.dia-tab').forEach(tab => {
      tab.classList.remove('activo');
    });
    
    // Encontrar el bot√≥n correcto (puede haber m√∫ltiples elementos con la misma clase)
    const tabs = document.querySelectorAll('.dia-tab');
    for (let i = 0; i < tabs.length; i++) {
      if (tabs[i].textContent.trim() === dia) {
        tabs[i].classList.add('activo');
        break;
      }
    }
    
    // Actualizar contenido activo
    document.querySelectorAll('.dia-contenido').forEach(contenido => {
      contenido.classList.remove('activo');
    });
    document.getElementById(`horario-${dia}`).classList.add('activo');
  }

  // ===============================
  // FUNCIONES PARA SEMESTRES (ALUMNO)
  // ===============================

  function cambiarSemestreAlumno(semestre) {
    // Actualizar pesta√±as de semestre
    document.querySelectorAll('.semestre-tab').forEach(tab => {
      tab.classList.remove('activo');
    });
    event.currentTarget.classList.add('activo');
    
    // Actualizar contenido de semestre
    document.querySelectorAll('.contenido-semestre').forEach(contenido => {
      contenido.classList.remove('activo');
    });
    document.getElementById(`contenido-${semestre}`).classList.add('activo');
  }

  // ===============================
  // INICIALIZACI√ìN
  // ===============================

  // Cargar datos al iniciar
  window.addEventListener('DOMContentLoaded', function() {
    cargarDatos();
    
    // Agregar algunos datos de ejemplo si es la primera vez
    if (comunicados.length === 0) {
      comunicados = [
        {
          fecha: new Date().toISOString().split('T')[0],
          titulo: "Bienvenida al Sistema",
          mensaje: "Bienvenidos al sistema de control escolar. Aqu√≠ encontrar√°n toda la informaci√≥n acad√©mica del grupo.",
          autor: "Administraci√≥n",
          importante: true
        }
      ];
    }
    
    if (recordatorios.length === 0) {
      const fechaFutura = new Date();
      fechaFutura.setDate(fechaFutura.getDate() + 7);
      
      recordatorios = [
        {
          titulo: "Entrega de proyectos",
          descripcion: "Recuerden entregar sus proyectos finales de programaci√≥n",
          fecha: fechaFutura.toISOString().split('T')[0]
        }
      ];
    }
    
    guardarDatos();
  });
</script>

</body>
</html>